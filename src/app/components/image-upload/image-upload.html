<div class="image-upload-container">
  <!-- Drop Zone -->
  <div
    class="drop-zone"
    [class.dragging]="isDragging()"
    [class.has-image]="previewUrl()"
    (dragover)="onDragOver($event)"
    (dragleave)="onDragLeave($event)"
    (drop)="onDrop($event)"
    (click)="!previewUrl() && triggerFileInput()"
  >
    @if (isProcessing()) {
      <div class="processing">
        <mat-spinner diameter="48"></mat-spinner>
        <p>Processing image...</p>
      </div>
    } @else if (previewUrl()) {
      <!-- Preview -->
      <div class="preview">
        <img [src]="previewUrl()" alt="Preview" [class.aspect-square]="aspectRatio === 'square'">
        <div class="preview-overlay">
          <button mat-icon-button class="change-btn" (click)="triggerFileInput(); $event.stopPropagation()">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button class="remove-btn" (click)="removeImage(); $event.stopPropagation()">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>
    } @else {
      <!-- Upload Prompt -->
      <div class="upload-prompt">
        <mat-icon class="upload-icon">cloud_upload</mat-icon>
        <h3>{{ buttonText }}</h3>
        <p>Drag & drop or click to browse</p>
        <span class="hint">JPEG, PNG, WebP • Max 5MB • Min 256x256px</span>
      </div>
    }
  </div>

  <!-- Hidden File Input -->
  <input
    type="file"
    id="file-input"
    accept="image/jpeg,image/png,image/webp"
    (change)="onFileSelected($event)"
    style="display: none"
  >

  <!-- Error Message -->
  @if (errorMessage()) {
    <div class="error-message">
      <mat-icon>error</mat-icon>
      <span>{{ errorMessage() }}</span>
    </div>
  }
</div>
